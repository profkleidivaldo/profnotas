<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Espelho de Notas</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 1300px;
  margin: auto;
  padding: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 14px;
}

th, td {
  border: 1px solid #ccc;
  padding: 5px;
  text-align: center;
}

th {
  background: #f0f0f0;
}

input, select, textarea, button {
  width: 100%;
  padding: 6px;
  box-sizing: border-box;
}

textarea {
  resize: vertical;
}

button {
  background: #1976d2;
  color: white;
  border: none;
  cursor: pointer;
  padding: 10px;
  margin-top: 5px;
}

button:hover {
  background: #125aa0;
}
</style>
</head>

<body>

<h2>Espelho de Notas e Frequ√™ncia</h2>

<label>Turma</label>
<input id="turma" placeholder="Ex: 5A">

<label>Bimestre</label>
<select id="bimestre">
  <option value="1¬∫ Bimestre">1¬∫ Bimestre</option>
  <option value="2¬∫ Bimestre">2¬∫ Bimestre</option>
  <option value="3¬∫ Bimestre">3¬∫ Bimestre</option>
  <option value="4¬∫ Bimestre">4¬∫ Bimestre</option>
</select>

<label>Colar dados do Excel</label>
<textarea id="excelInput" rows="4"
placeholder="RA | Nome | LP | Arte | EF | ER | MAT | GEO | HIS | CIE | Faltas"></textarea>

<button onclick="importarExcel()">üì• Importar do Excel</button>
<button onclick="adicionarLinha()">‚ûï Linha manual</button>
<button onclick="gerarJS()">‚¨áÔ∏è Gerar arquivo da turma</button>

<table>
<thead>
<tr>
  <th>RA</th>
  <th>Estudante</th>
  <th>LP</th>
  <th>Arte</th>
  <th>Ed. F√≠sica</th>
  <th>Ens. Religioso</th>
  <th>Mat.</th>
  <th>Geo.</th>
  <th>Hist.</th>
  <th>Ci√™n.</th>
  <th>Faltas</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
function adicionarLinha(valores = []) {
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td><input value="${valores[0]||""}"></td>
    <td><input value="${valores[1]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[2]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[3]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[4]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[5]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[6]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[7]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[8]||""}"></td>
    <td><input type="number" step="0.1" value="${valores[9]||""}"></td>
    <td><input type="number" value="${valores[10]||""}"></td>
  `;
  document.getElementById("tbody").appendChild(tr);
}

function importarExcel() {
  const linhas = document.getElementById("excelInput").value.trim().split(/\r?\n/);
  linhas.forEach(l => adicionarLinha(l.split("\t")));
  document.getElementById("excelInput").value = "";
}

function gerarJS() {
  const turma = document.getElementById("turma").value.trim();
  const bimestre = document.getElementById("bimestre").value;
  if (!turma) return alert("Informe a turma.");

  const registros = [];

  document.querySelectorAll("#tbody tr").forEach(tr => {
    const c = tr.querySelectorAll("input");
    if (!c[0].value) return;

    const aluno = {
      ra: c[0].value,
      nome: c[1].value,
      turma,
      bimestre,
      notas: {
        LP: c[2].value,
        ARTE: c[3].value,
        EF: c[4].value,
        ER: c[5].value,
        MAT: c[6].value,
        GEO: c[7].value,
        HIS: c[8].value,
        CIE: c[9].value
      },
      faltas: c[10].value
    };

    const dados = CryptoJS.AES.encrypt(JSON.stringify(aluno), aluno.ra).toString();
    registros.push({ ra: aluno.ra, dados });
  });

  const js =
`// Turma ${turma}
window.DADOS_TURMA = ${JSON.stringify(registros, null, 2)};`;

  const blob = new Blob([js], { type: "application/javascript" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `${turma}.js`;
  a.click();
}
</script>

</body>
</html>
